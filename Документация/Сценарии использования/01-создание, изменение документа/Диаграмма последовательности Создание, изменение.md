# Прецедент 1: Создание и редактирование документа
```mermaid
sequenceDiagram
    participant User
    participant Main
    participant Editor
    participant Document
    participant CompositeManager
    participant Paragraph
    participant Sentence
    participant Word
    participant Letter
    participant Cursor

    Note over User, Editor: 1) СОЗДАНИЕ НОВОГО ДОКУМЕНТА

    User->>Main: NewDocument(name)
    Main->>Editor: NewDocument(name)
    activate Editor
    Editor->>Document: new Document(name)
    activate Document
    Document-->>Editor: пустой объект Document
    deactivate Document

    Editor->>Document: cursor = new Cursor()
    Editor->>Document: SplitIfNeeded()
    Editor-->>Main: Document готов
    deactivate Editor

    Note over User, Editor: 2) ВВОД ТЕКСТА ("Hello world\\nHi")

    User->>Editor: ввод текста "Hello world\\nHi"
    activate Editor
    Editor->>Editor: парсинг строки (по \\n, пробелам, точкам)
    
    loop для каждого параграфа
        Editor->>CompositeManager: Add(Document, Paragraph)
        activate CompositeManager

        loop для каждого предложения в параграфе
            CompositeManager->>Paragraph: Add(Paragraph, Sentence)
            activate Paragraph

            loop для каждого слова в предложении
                CompositeManager->>Sentence: Add(Sentence, Word)
                activate Sentence

                loop для каждой буквы в слове
                    CompositeManager->>Word: Add(Word, Letter)
                    activate Word
                    Word-->>CompositeManager: Letter создан
                    deactivate Word
                end
                Sentence-->>CompositeManager: Word добавлено
                deactivate Sentence
            end
            Paragraph-->>CompositeManager: Sentence добавлено
            deactivate Paragraph
        end

        CompositeManager-->>Editor: Paragraph добавлен
        deactivate CompositeManager
    end

    Editor->>Document: SplitIfNeeded()
    Document-->>Editor: структура согласована
    Editor->>Document: MoveCursorTo(последний_элемент)
    Document->>Cursor: currentElementId = id последней буквы
    Cursor-->>Document: позиция курсора обновлена
    Editor-->>Main: обновить интерфейс (UI)
    deactivate Editor

    Note over User, Editor: 3) ИЗМЕНЕНИЕ ДОКУМЕНТА (ReplaceAll)

    User->>Editor: ReplaceAll("world", "planet")
    activate Editor
    Editor->>CompositeManager: ReplaceText(Document, "world", "planet")
    activate CompositeManager

    loop Traverse(Document)
        CompositeManager->>Word: GetText(Word)
        alt если найдено совпадение
            CompositeManager->>Word: Remove(old Letters)
            CompositeManager->>Word: Add(new Letters "planet")
        end
    end

    CompositeManager-->>Editor: завершена замена
    deactivate CompositeManager

    Editor->>Document: SplitIfNeeded()
    Editor->>Document: MoveCursorTo(новая позиция)
    Editor-->>Main: обновление интерфейса (UI)
    deactivate Editor


```


