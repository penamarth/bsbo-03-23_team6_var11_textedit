# Прецедент 1: Создание и редактирование документа
```mermaid
sequenceDiagram
    autonumber

    participant User
    participant Main
    participant Editor
    participant Document
    participant CompositeManager
    participant Paragraph
    participant Sentence
    participant Word
    participant Letter
    participant Cursor

    %% ==========================================================
    %% ШАГ 1. Создание документа
    %% ==========================================================
    User ->> Main: Запрос: создать новый документ
    Main ->> Editor: NewDocument(name)

    activate Editor
    Editor ->> Document: <<create>> Document(name)
    activate Document

    Document ->> Cursor: <<create>> Cursor()
    Cursor -->> Document: cursor initialized

    Editor -->> Main: Document создан

    %% ==========================================================
    %% ШАГ 2. Добавление текста в документ
    %% ==========================================================
    User ->> Main:  Ввод текста
    Main ->> Editor: InsertText("Hello world!")

    %% Editor вызывает Document.Add()
    Editor ->> Document: Add("Hello world!")

    %% Document использует CompositeManager для обработки
    Document ->> CompositeManager: Add(parent=document, child="Hello world!")

    activate CompositeManager

    %% ==========================================================
    %% внутренний парсинг и построение структуры
    %% ==========================================================

    %% Document вызывает SplitIfNeeded(), чтобы разбить текст
    Document ->> Document: SplitIfNeeded("Hello world!")

    %% создаём структуру:

    Document ->> Paragraph: <<create>> Paragraph()
    activate Paragraph

    CompositeManager ->> Document: Add(parent=document, child=Paragraph)

    Document ->> Sentence: <<create>> Sentence()
    activate Sentence
    CompositeManager ->> Paragraph: Add(parent=Paragraph, child=Sentence)

    %% ----- Word 1 -----
    Document ->> Word: <<create>> Word("Hello")
    activate Word
    CompositeManager ->> Sentence: Add(parent=Sentence, child=Word)

    Word ->> Word: GetText()
    Word ->> Letter: <<create>> Letters(H,e,l,l,o)
    deactivate Word

    %% ----- Word 2 -----
    Document ->> Word: <<create>> Word("world!")
    activate Word
    CompositeManager ->> Sentence: Add(parent=Sentence, child=Word)

    Word ->> Word: GetText()
    Word ->> Letter: <<create>> Letters(w,o,r,l,d,!)
    deactivate Word

    deactivate Sentence
    deactivate Paragraph

    CompositeManager -->> Document: добавление выполнено
    deactivate CompositeManager

    Document -->> Editor: текст добавлен


    %% ==========================================================
    %% ШАГ 3. Замена текста (изменение документа)
    %% ==========================================================
    User ->> Main: Изменить текст: "Hello", "Hi"
    Main ->> Editor: ReplaceAll("Hello", "Hi")

    %% Editor вызывает CompositeManager.ReplaceText()
    Editor ->> CompositeManager: ReplaceText(Document, "Hello", "Hi")
    activate CompositeManager

    %% CompositeManager вызывает Traverse()
    CompositeManager ->> CompositeManager: Traverse(Document, action=replace)

    %% Перебор структуры:
    CompositeManager ->> Document: traverse paragraphs
    CompositeManager ->> Paragraph: traverse sentences
    CompositeManager ->> Sentence: traverse words

    %% Проверка каждого слова
    CompositeManager ->> Word: GetText()
    Word -->> CompositeManager: "Hello"

    %% Замена
    CompositeManager ->> Word: ReplaceText(node=Word, old="Hello", new="Hi")
    Word ->> Word: SetText("Hi")

    deactivate CompositeManager

    Editor -->> Main: Замена завершена



```


