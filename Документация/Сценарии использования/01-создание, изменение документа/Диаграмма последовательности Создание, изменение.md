# Прецедент 1: Создание и редактирование документа
```mermaid
sequenceDiagram
    autonumber

    participant User
    participant Main
    participant Editor
    participant Document
    participant CompositeManager
    participant Paragraph
    participant Sentence
    participant Word
    participant Letter
    participant Cursor


    %% ==========================================
    %% 1) СОЗДАНИЕ ДОКУМЕНТА
    %% ==========================================

    Note over User,Editor: 1) Создание нового документа

    User->>Main: Создать новый документ("mydoc")
    Main->>Editor: NewDocument("mydoc")
    activate Editor

    Editor->>Document: <<create>> Document("mydoc")
    activate Document

    Document->>Cursor: <<create>> Cursor()
    Cursor-->>Document: cursor initialized

    Document-->>Editor: документ создан
    deactivate Document

    Editor-->>Main: Document создан
    deactivate Editor



    %% ==========================================
    %% 2) ДОБАВЛЕНИЕ ТЕКСТА
    %% ==========================================

    Note over User,Editor: 2) Добавление текста в документ

    User->>Main: Ввод текста: "Hello world!"
    Main->>Editor: InsertText("Hello world!")
    activate Editor

    Editor->>Document: Add("Hello world!")
    activate Document

    %% ---- Document вызывает CompositeManager ----
    Document->>CompositeManager: Add(document, "Hello world!")
    activate CompositeManager

    %% ---- Разбиение текста ----
    Document->>Document: SplitIfNeeded("Hello world!")

    %% ---- Создание структуры Composite ----
    Document->>Paragraph: <<create>> Paragraph()
    activate Paragraph
    CompositeManager->>Document: Add(document, Paragraph)

    Document->>Sentence: <<create>> Sentence()
    activate Sentence
    CompositeManager->>Paragraph: Add(Paragraph, Sentence)

    %% ---- Word 1 ----
    Document->>Word: <<create>> Word("Hello")
    activate Word
    CompositeManager->>Sentence: Add(Sentence, Word)

    Word->>Word: GetText()
    Word->>Letter: <<create>> Letters(H,e,l,l,o)
    deactivate Word

    %% ---- Word 2 ----
    Document->>Word: <<create>> Word("world!")
    activate Word
    CompositeManager->>Sentence: Add(Sentence, Word)

    Word->>Word: GetText()
    Word->>Letter: <<create>> Letters(w,o,r,l,d,!)
    deactivate Word

    deactivate Sentence
    deactivate Paragraph

    CompositeManager-->>Document: добавление завершено
    deactivate CompositeManager

    Document-->>Editor: текст добавлен
    deactivate Document

    Editor-->>Main: Добавление текста выполнено
    deactivate Editor



    %% ==========================================
    %% 3) ЗАМЕНА ТЕКСТА
    %% ==========================================

    Note over User,Editor: 3) Замена текста в документе

    User->>Main: Изменить текст: "Hello", "Hi"
    Main->>Editor: ReplaceAll("Hello", "Hi")
    activate Editor

    Editor->>CompositeManager: ReplaceText(Document, "Hello", "Hi")
    activate CompositeManager

    %% ---- Обход Composite через Traverse() ----
    CompositeManager->>CompositeManager: Traverse(Document, replace)

    CompositeManager->>Document: traverse paragraphs
    CompositeManager->>Paragraph: traverse sentences
    CompositeManager->>Sentence: traverse words

    %% ---- Проверка слова ----
    CompositeManager->>Word: GetText()
    Word-->>CompositeManager: "Hello"

    %% ---- Замена ----
    CompositeManager->>Word: ReplaceText("Hello", "Hi")
    Word->>Word: SetText("Hi")

    CompositeManager-->>Editor: замена завершена
    deactivate CompositeManager

    Editor-->>Main: ReplaceAll выполнен
    deactivate Editor




```


